"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7158],{7158:(w,u,r)=>{r.r(u),r.d(u,{PuntoDeVentaPageModule:()=>q});var d=r(6895),s=r(4719),c=r(7479),p=r(6069),_=r(5861),t=r(6738),m=r(529),h=r(1549);let P=(()=>{class n{constructor(e,o){this.http=e,this.dbService=o}getProductsForSale(){var e=this;return(0,_.Z)(function*(){const o={params:{tableName:"products",columnsToRead:JSON.stringify(["product_id","product_name","product_sellingprice"])},action:"getProductsForSale"},a=yield e.http.post(e.dbService.apiURL+"pointOfSale",o,{}).toPromise();return!!a&&(console.log(a),a)})()}completeSale(e){var o=this;return(0,_.Z)(function*(){return!!(yield o.dbService.insertRecordToDB(e,"salidas"))})()}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(m.eN),t.LFG(h.k))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function T(n,i){if(1&n&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",e," ")}}function C(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"table",16)(1,"tr"),t.YNc(2,T,2,1,"td",17),t.qZA(),t.TgZ(3,"tr")(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.qZA(),t.TgZ(8,"td")(9,"ion-input",18),t.NdJ("ngModelChange",function(a){t.CHM(e);const l=t.oxw(2);return t.KtG(l.selectedItemUnits=a)}),t.qZA()(),t.TgZ(10,"td")(11,"ion-button",19),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.addProductToSale(a.selectedItem))}),t._uU(12," Agregar "),t.qZA()()()()}if(2&n){const e=t.oxw(2);t.xp6(2),t.Q6J("ngForOf",e.addProductTableHeaders),t.xp6(3),t.hij(" ",e.selectedItem.product_name," "),t.xp6(2),t.hij(" ",e.selectedItem.product_id," "),t.xp6(2),t.Q6J("ngModel",e.selectedItemUnits),t.xp6(2),t.Q6J("disabled",!e.selectedItemUnits)}}function x(n,i){if(1&n&&(t.TgZ(0,"td",21),t._uU(1),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",e," ")}}function f(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td"),t.ynx(10),t.TgZ(11,"ion-icon",22),t.NdJ("click",function(){const l=t.CHM(e).$implicit,g=t.oxw(3);return t.KtG(g.deleteItemFromSale(l.product_name))}),t.qZA(),t.BQk(),t.qZA()()}if(2&n){const e=i.$implicit;t.xp6(2),t.hij(" ",e.product_name," "),t.xp6(2),t.hij(" ",e.unites," "),t.xp6(2),t.hij(" $",e.sellingPrice," "),t.xp6(2),t.hij(" $",e.subtotal," ")}}function Z(n,i){if(1&n&&(t.TgZ(0,"table",12)(1,"tr"),t.YNc(2,x,2,1,"td",13),t.qZA(),t.YNc(3,f,12,4,"tr",14),t.qZA()),2&n){const e=t.oxw(2);t.xp6(2),t.Q6J("ngForOf",e.saleTableHeaders),t.xp6(1),t.Q6J("ngForOf",e.itemsIncludedInSale)}}function b(n,i){if(1&n&&(t.TgZ(0,"ion-select-option",28),t._uU(1),t.qZA()),2&n){const e=i.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}function M(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"ion-grid",23)(1,"ion-row")(2,"ion-col",24),t._uU(3," Total "),t.qZA(),t.TgZ(4,"ion-col"),t._uU(5),t.qZA()(),t.TgZ(6,"ion-row")(7,"ion-col"),t._uU(8," Recibo "),t.qZA(),t.TgZ(9,"ion-col")(10,"ion-input",25),t.NdJ("ngModelChange",function(a){t.CHM(e);const l=t.oxw(2);return t.KtG(l.cashReceivment=a)}),t.qZA()()(),t.TgZ(11,"ion-row")(12,"ion-col"),t._uU(13,"Cambio"),t.qZA(),t.TgZ(14,"ion-col"),t._uU(15),t.qZA()(),t.TgZ(16,"ion-row")(17,"ion-col"),t._uU(18,"Tipo venta"),t.qZA(),t.TgZ(19,"ion-col")(20,"ion-select",26),t.NdJ("ngModelChange",function(a){t.CHM(e);const l=t.oxw(2);return t.KtG(l.selectedSaleOption=a)}),t.YNc(21,b,2,2,"ion-select-option",27),t.qZA()()()()}if(2&n){const e=t.oxw(2);t.xp6(5),t.hij(" $",e.saleTotal()," "),t.xp6(5),t.Q6J("ngModel",e.cashReceivment),t.xp6(5),t.hij("$",e.getCashback(),""),t.xp6(5),t.Q6J("placeholder",e.selectedSaleOption)("ngModel",e.selectedSaleOption),t.xp6(1),t.Q6J("ngForOf",e.saleOptions)}}function O(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",29),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.completeSale())}),t._uU(1," Completar venta "),t.qZA()}if(2&n){const e=t.oxw(2);t.Q6J("disabled",(!e.cashReceivment||e.cashReceivment<e.saleTotal())&&"Venta"===e.selectedSaleOption)}}function A(n,i){if(1&n&&(t.TgZ(0,"td",21),t._uU(1),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",e," ")}}function I(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t.ynx(8),t.TgZ(9,"ion-icon",30),t.NdJ("click",function(){const l=t.CHM(e).$implicit,g=t.oxw(2);return t.KtG(g.selectProduct(l))}),t.qZA(),t.BQk(),t.qZA()()}if(2&n){const e=i.$implicit;t.xp6(2),t.hij(" ",e.product_id," "),t.xp6(2),t.hij(" ",e.product_name," "),t.xp6(2),t.hij(" $",e.product_sellingprice," ")}}function S(n,i){if(1&n&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA()()),2&n){const e=i.$implicit;t.xp6(2),t.hij(" ",e.product_name," "),t.xp6(2),t.hij(" ",e.unites," "),t.xp6(2),t.hij(" ",e.subtotal," ")}}function v(n,i){if(1&n&&(t.TgZ(0,"div",31),t._UZ(1,"img",32),t.TgZ(2,"h5",33),t._uU(3,"TICKET DE VENTA"),t.qZA(),t.TgZ(4,"h5",33),t._uU(5,"Nutrilios Store FASPYN UANL"),t.qZA(),t.TgZ(6,"h5",34),t._uU(7),t.qZA(),t.TgZ(8,"table",35)(9,"thead")(10,"th"),t._uU(11," PRODUCTO "),t.qZA(),t.TgZ(12,"th"),t._uU(13," CANT"),t.qZA(),t.TgZ(14,"th"),t._uU(15," $$"),t.qZA()(),t.TgZ(16,"tbody"),t.YNc(17,S,7,3,"tr",14),t.TgZ(18,"tr"),t._UZ(19,"td"),t.TgZ(20,"td",36),t._uU(21,"Total"),t.qZA(),t.TgZ(22,"td",36),t._uU(23),t.qZA()()()(),t.TgZ(24,"h5"),t._uU(25," Gracias por su compra!!"),t.qZA()()),2&n){const e=t.oxw(2);t.xp6(7),t.AsE("",e.saleCompleted.saleDate," ",e.saleCompleted.saleHour,""),t.xp6(10),t.Q6J("ngForOf",e.saleCompleted.items),t.xp6(6),t.hij(" $",e.saleCompleted.total,"")}}function U(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"ion-content")(1,"div",2)(2,"div",3)(3,"h3"),t._uU(4,"Venta"),t.qZA(),t.TgZ(5,"div",4)(6,"ion-input",5),t.NdJ("ngModelChange",function(a){t.CHM(e);const l=t.oxw();return t.KtG(l.filterItems=a)}),t.qZA(),t._UZ(7,"ion-icon",6),t.qZA(),t.YNc(8,C,13,5,"table",7),t.YNc(9,Z,4,2,"table",8),t.YNc(10,M,22,6,"ion-grid",9),t.YNc(11,O,2,1,"ion-button",10),t.qZA(),t.TgZ(12,"div",11)(13,"h3"),t._uU(14," Productos disponibles "),t.qZA(),t.TgZ(15,"table",12)(16,"tr"),t.YNc(17,A,2,1,"td",13),t.qZA(),t.YNc(18,I,10,3,"tr",14),t.qZA(),t.YNc(19,v,26,4,"div",15),t.qZA()()()}if(2&n){const e=t.oxw();t.xp6(6),t.Q6J("ngModel",e.filterItems),t.xp6(2),t.Q6J("ngIf",e.selectedItem.product_name),t.xp6(1),t.Q6J("ngIf",e.itemsIncludedInSale.length),t.xp6(1),t.Q6J("ngIf",e.itemsIncludedInSale.length),t.xp6(1),t.Q6J("ngIf",e.itemsIncludedInSale.length),t.xp6(6),t.Q6J("ngForOf",e.inventaryTableHeaders),t.xp6(1),t.Q6J("ngForOf",e.productsAvailableForSale),t.xp6(1),t.Q6J("ngIf",e.saleCompleted)}}const D=[{path:"",component:(()=>{class n{constructor(e){this.posService=e,this.saleOptions=["Venta","Cortes\xeda","Merma"],this.selectedSaleOption="Venta",this.saleTableHeaders=["Nombre del producto","Unidades","Precio de venta","Subtotal","Eliminar"],this.inventaryTableHeaders=["C\xf3digo","Nombre del producto","Precio de venta","Seleccionar"],this.addProductTableHeaders=["Producto","C\xf3digo","Unidades",""],this.filterItems="",this.itemsIncludedInSale=[],this.selectedItem={},this.selectedItemUnits=0}ngOnInit(){var e=this;return(0,_.Z)(function*(){e.productsAvailableForSale=yield e.posService.getProductsForSale(),e.dataLoaded=!0})()}deleteItemFromSale(e){this.itemsIncludedInSale=this.itemsIncludedInSale.filter(o=>o.product_name!==e)}completeSale(){const e=new Date,o={salida_productos:JSON.stringify(this.itemsIncludedInSale),salida_fecha:`${e.getDate()}/${e.getMonth()+1}/2022`,salida_responsable:"Usuario an\xf3nimo",salida_total:this.saleTotal().toString(),salida_tipo:this.selectedSaleOption},a=this.posService.completeSale(o);console.log(a?"Guardao al cien":"valiend0 madre compare"),this.saleCompleted=o,this.saleCompleted.salida_hora=`${e.getHours()}:${e.getMinutes()}`;const l=document.querySelector(".ticketDeCompra");this.printTicket(l),console.log(o)}printTicket(e){const o=window.open("","PRINT","height=400,width=600");return o.document.write("<html><head><title>"+document.title+"</title>"),o.document.write('<link rel="stylesheet" href="ticket-de-compra.css">'),o.document.write("</head><body >"),o.document.write(e.innerHTML),o.document.write("</body></html>"),o.document.close(),o.focus(),o.onload=()=>{o.print(),o.close()},!0}addProductToSale(e){this.itemsIncludedInSale.push({product_id:e.product_id,product_name:this.selectedItem.product_name,unites:this.selectedItemUnits,sellingPrice:this.selectedItem.product_sellingprice,subtotal:this.selectedItemUnits*this.selectedItem.product_sellingprice})}getCashback(){let e=this.saleTotal()-this.cashReceivment;return isNaN(e)?0:this.cashReceivment<this.saleTotal()?"":-1*e}saleTotal(){let e=0;return this.itemsIncludedInSale.forEach(o=>{e+=o.subtotal}),e}selectProduct(e){this.selectedItem.product_name=e.product_name,this.selectedItem.product_id=e.product_id,this.selectedItem.product_sellingprice=e.product_sellingprice}ionViewDidLoad(){console.log("ionViewDidLoad PuntoDeVentaPage")}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(P))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-punto-de-venta"]],decls:7,vars:1,consts:[["slot","start"],[4,"ngIf"],[1,"generalContainer"],[1,"productSearchAndTabContainer"],[2,"display","flex","flex-direction","row"],["type","text",1,"form-control",3,"ngModel","ngModelChange"],["name","search"],["class","addProductTable",4,"ngIf"],["class","basicTable",4,"ngIf"],["class","changeAndTotalContainer",4,"ngIf"],["style","width: 100%;",3,"disabled","click",4,"ngIf"],[1,"productsListContainer"],[1,"basicTable"],["class","tableHeaders",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["class","ticketDeCompra",4,"ngIf"],[1,"addProductTable"],["class","headers",4,"ngFor","ngForOf"],["placeholer","Cantidad","type","numeric",2,"margin","0",3,"ngModel","ngModelChange"],[3,"disabled","click"],[1,"headers"],[1,"tableHeaders"],["name","trash","color","danger",3,"click"],[1,"changeAndTotalContainer"],[1,"importante"],[3,"ngModel","ngModelChange"],["interface","popover",3,"placeholder","ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[2,"width","100%",3,"disabled","click"],["name","checkmark-circle-outline","color","primary",3,"click"],[1,"ticketDeCompra"],["src","../../assets/imgs/logo-generico.webp",1,"ticketImage"],[2,"margin","0"],[2,"margin","0px 0px 10px 0px"],[1,"ticketContentTable"],[2,"font-weight","bolder"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-menu-button"),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5,"Punto de venta"),t.qZA()()(),t.YNc(6,U,20,8,"ion-content",1)),2&e&&(t.xp6(6),t.Q6J("ngIf",o.dataLoaded))},dependencies:[d.sg,d.O5,s.JJ,s.On,c.YG,c.Sm,c.wI,c.W2,c.jY,c.Gu,c.gu,c.pK,c.fG,c.Nd,c.t9,c.n0,c.wd,c.sr,c.QI,c.j9],styles:[".generalContainer[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:100%;height:100%;padding:0;margin:0}ion-input[_ngcontent-%COMP%]{margin:0}.productSearchAndTabContainer[_ngcontent-%COMP%]{display:flex;flex-basis:50%;flex-direction:column;padding:10px}.productSearchAndTabContainer[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{max-height:30px}.productSearchAndTabContainer[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0 10px}.productSearchAndTabContainer[_ngcontent-%COMP%]   .addProductTable[_ngcontent-%COMP%]{margin:20px 0 10px;width:100%}.productSearchAndTabContainer[_ngcontent-%COMP%]   .addProductTable[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]{font-weight:900}.productSearchAndTabContainer[_ngcontent-%COMP%]   .addProductTable[_ngcontent-%COMP%]   .headers[_ngcontent-%COMP%]:nth-child(3n){min-width:20%;max-width:20%}.productSearchAndTabContainer[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{align-self:center}.form-control[_ngcontent-%COMP%]{border-bottom:1px solid gray;padding:5px;max-width:400px;text-align:center}.form-control[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{margin:0}.ticketDeCompra[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.ticketDeCompra[_ngcontent-%COMP%]   .ticketImage[_ngcontent-%COMP%]{height:120px;width:120px}.ticketDeCompra[_ngcontent-%COMP%]   .ticketContentTable[_ngcontent-%COMP%]{text-align:center}.ticketDeCompra[_ngcontent-%COMP%]   .ticketContentTable[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{border-top:thick black;border-bottom:thick black}.ticketDeCompra[_ngcontent-%COMP%]   .ticketContentTable[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{margin:0}.ticketDeCompra[_ngcontent-%COMP%]   .ticketContentTable[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:last-child{margin:0 0 10px}.productsListContainer[_ngcontent-%COMP%]{padding:10px;display:flex;flex-basis:50%;flex-direction:column;align-items:center}.basicTable[_ngcontent-%COMP%]{min-width:100%;max-width:100%;border:2px solid black;margin-bottom:10px}.basicTable[_ngcontent-%COMP%]   .tableHeaders[_ngcontent-%COMP%]{margin-left:10px;margin-right:10px;background-color:#32db64;color:#fff}.basicTable[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px;text-align:center}.basicTable[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(even){background-color:#cacaca}.changeAndTotalContainer[_ngcontent-%COMP%]{width:80%;margin:inherit;align-self:flex-end;font-size:1.4em}.changeAndTotalContainer[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{width:100%;margin:0;padding:0 5px 0 0}.changeAndTotalContainer[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{border:1px solid gray;border-radius:10px;height:30px;margin:0}.changeAndTotalContainer[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0 0 0 5px}"]}),n})()}];let k=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[p.Bz.forChild(D),p.Bz]}),n})(),q=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[d.ez,s.u5,c.Pc,k]}),n})()}}]);